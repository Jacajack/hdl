module fancy_counter{
	input clock clk;
	input async wire nreset;
	input comb(clk) wire enable;
	output unsigned sync(clk) bus<16> data;
	output unsigned comb(clk) bus<16> fancy_data;
}

impl fancy_counter{
	wire en = enable;
	bus<16> counter_next = (data + 1u1)[0:15];
	register counter{
		clk, nreset, en,
		next: counter_next,
		data,
	};

	unsigned sync(clk) bus<16> counter_last;
	register delayed{
		clk, nreset, en,
		next: data,
		data: counter_last
	};

	fancy_data = match (data) {
		0 => 17,
		1 => 1287,
		17 => 2137,
		default => ((counter_last ^ data) + data)[0:15],
	};
}

